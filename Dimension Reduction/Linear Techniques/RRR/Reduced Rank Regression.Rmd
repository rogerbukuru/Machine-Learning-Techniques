---
title: "Reduced Rank Regression"
author: "Roger Bukuru"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, 
  message = FALSE,
  tidy=TRUE)
```

We proceed to implement Reduced Rank Regression from first principals

```{r, echo = TRUE}
rm(list= ls())
library(dplyr)
library(tidyverse)

tobacco = read.csv("../../../Data/RRR/tobacco.csv") %>%
          as.tibble()

head(tobacco)

sigma_XX = cov(tobacco[, 4:9])
sigma_XX

sigma_YY = cov(tobacco[, 1:3])
sigma_YY

X = tobacco%>%
    select(4:9)
X = t(X)
Y = tobacco%>%
    select(1:3)
Y = t(Y)

```

Calculate $\mu_x$ and $\mu_y$

```{r, echo = TRUE}
mux = apply(X, 1, mean)
muy = apply(Y, 1, mean)

mux
muy
```

Create X_c and Y_c i.e centered versions

```{r, echo = TRUE}
X_c = apply(X, 1, function(X) (X-mean(X)))
Y_c = apply(Y, 1, function(Y) (Y-mean(Y)))
```

Calculate $S_{xx}$ $S_{yy}$ & $S_{xy}$ using cross products of centered data matrices.

```{r, echo = TRUE}
#Place xc and yc back into form similar to book
X_c = t(X_c)
Y_c = t(Y_c)

n = nrow(tobacco)
Sxx = (1/(n-1))*tcrossprod(X_c)
Syy = (1/(n-1))*tcrossprod(Y_c)
Syx = (1/(n-1))*tcrossprod(Y_c, X_c) # Transpose second param i.e Y_c%*%t(X_c)
Sxy = t(Syx)
Syx

solve()

```


# Note sure understand how A&B come into this picture



# PAH

```{r, echo. = TRUE}
library(rrpack)
rm(list = ls())
pah = read.table("../../../Data/RRR/PAH.txt", header =  TRUE, sep = " ") %>%
      as.tibble()

responses = pah[,1:11] %>%
            as.matrix()

predictors = pah[, 12:38] %>%
             as.matrix()

rrr_model = rrr(Y = responses, X = predictors, penaltySVD = "rank")

summary(rrr_model)
coef(rrr_model)
plot(rrr_model)

```